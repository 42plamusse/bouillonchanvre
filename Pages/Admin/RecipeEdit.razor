@page "/admin/recipes/create"
@page "/admin/recipes/edit/{Id:int}"
@inject HttpClient Http
@inject NavigationManager NavigationManager
@using BouillonChanvre.Models

@code {
    [Parameter]
    public int? Id { get; set; }

    private Recipe recipe = new Recipe
    {
        Title = string.Empty,
        Description = string.Empty,
        Ingredients = string.Empty,
        Instructions = string.Empty,
        Difficulty = string.Empty,
        ImageUrl = string.Empty
    };

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue)
        {
            recipe = await Http.GetFromJsonAsync<Recipe>($"api/recipes/{Id.Value}");
        }
    }

    private async Task SaveRecipe()
    {
        if (Id.HasValue)
        {
            await Http.PutAsJsonAsync($"api/recipes/{Id.Value}", recipe);
        }
        else
        {
            await Http.PostAsJsonAsync("api/recipes", recipe);
        }
        NavigationManager.NavigateTo("/admin/recipes");
    }
}


<h3>@(Id.HasValue ? "Edit Recipe" : "Create Recipe")</h3>

<EditForm Model="recipe" OnValidSubmit="SaveRecipe">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="title">Title</label>
        <InputText id="title" class="form-control" @bind-Value="recipe.Title" />
    </div>
    <div class="mb-3">
        <label for="description">Description</label>
        <InputTextArea id="description" class="form-control" @bind-Value="recipe.Description" />
    </div>
    <div class="mb-3">
        <label for="ingredients">Ingredients</label>
        <InputTextArea id="ingredients" class="form-control" @bind-Value="recipe.Ingredients" />
    </div>
    <div class="mb-3">
        <label for="instructions">Instructions</label>
        <InputTextArea id="instructions" class="form-control" @bind-Value="recipe.Instructions" />
    </div>
    <div class="mb-3">
        <label for="preparationTime">Preparation Time (minutes)</label>
        <InputNumber id="preparationTime" class="form-control" @bind-Value="recipe.PreparationTime" />
    </div>
    <div class="mb-3">
        <label for="cookingTime">Cooking Time (minutes)</label>
        <InputNumber id="cookingTime" class="form-control" @bind-Value="recipe.CookingTime" />
    </div>
    <div class="mb-3">
        <label for="servings">Servings</label>
        <InputNumber id="servings" class="form-control" @bind-Value="recipe.Servings" />
    </div>
    <div class="mb-3">
        <label for="difficulty">Difficulty</label>
        <InputText id="difficulty" class="form-control" @bind-Value="recipe.Difficulty" />
    </div>
    <div class="mb-3">
        <label for="imageUrl">Image URL</label>
        <InputText id="imageUrl" class="form-control" @bind-Value="recipe.ImageUrl" />
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
    <button type="button" class="btn btn-secondary" @onclick='() => NavigationManager.NavigateTo("/admin/recipes")'>Cancel</button>
</EditForm>
